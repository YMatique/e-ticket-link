<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guia de Implementa√ß√£o - CityLink e-Ticket (√Årea P√∫blica)</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.6; color: #333; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 40px 20px; text-align: center; border-radius: 10px; margin-bottom: 30px; }
        header h1 { font-size: 2.5em; margin-bottom: 10px; }
        header p { font-size: 1.2em; opacity: 0.9; }
        .card { background: white; border-radius: 10px; padding: 30px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h2 { color: #667eea; margin-bottom: 20px; border-bottom: 3px solid #667eea; padding-bottom: 10px; }
        h3 { color: #764ba2; margin: 20px 0 15px; }
        .step { background: #f8f9fa; border-left: 4px solid #667eea; padding: 15px; margin: 15px 0; border-radius: 5px; }
        .step-number { display: inline-block; background: #667eea; color: white; width: 30px; height: 30px; border-radius: 50%; text-align: center; line-height: 30px; font-weight: bold; margin-right: 10px; }
        code { background: #f4f4f4; padding: 3px 8px; border-radius: 4px; font-family: 'Courier New', monospace; color: #e83e8c; }
        pre { background: #2d2d2d; color: #f8f8f2; padding: 20px; border-radius: 8px; overflow-x: auto; margin: 15px 0; }
        pre code { background: none; color: inherit; padding: 0; }
        .warning { background: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; margin: 15px 0; border-radius: 5px; }
        .success { background: #d4edda; border-left: 4px solid #28a745; padding: 15px; margin: 15px 0; border-radius: 5px; }
        .info { background: #d1ecf1; border-left: 4px solid #17a2b8; padding: 15px; margin: 15px 0; border-radius: 5px; }
        ul, ol { margin-left: 20px; margin-bottom: 15px; }
        li { margin-bottom: 8px; }
        .file-tree { font-family: monospace; background: #f8f9fa; padding: 15px; border-radius: 5px; }
        .file-tree .folder { color: #007bff; font-weight: bold; }
        .file-tree .file { color: #28a745; }
        table { width: 100%; border-collapse: collapse; margin: 15px 0; }
        table th, table td { padding: 12px; text-align: left; border: 1px solid #ddd; }
        table th { background: #667eea; color: white; }
        table tr:nth-child(even) { background: #f8f9fa; }
        .badge { display: inline-block; padding: 4px 10px; border-radius: 4px; font-size: 0.85em; font-weight: bold; }
        .badge-success { background: #28a745; color: white; }
        .badge-warning { background: #ffc107; color: #333; }
        .badge-info { background: #17a2b8; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üöå Guia de Implementa√ß√£o</h1>
            <p>Sistema P√∫blico de Compra de Bilhetes - CityLink e-Ticket</p>
        </header>

        <!-- Vis√£o Geral -->
        <div class="card">
            <h2>üìã Vis√£o Geral</h2>
            <p>Este guia cont√©m todas as instru√ß√µes para implementar a <strong>√°rea p√∫blica</strong> do sistema CityLink e-Ticket, onde os passageiros podem:</p>
            <ul>
                <li>‚úÖ Buscar viagens dispon√≠veis</li>
                <li>‚úÖ Visualizar hor√°rios e pre√ßos</li>
                <li>‚úÖ Selecionar assentos com mapa visual interativo</li>
                <li>‚úÖ Fazer reservas tempor√°rias (15 minutos)</li>
                <li>‚úÖ Proceder para checkout e pagamento</li>
            </ul>
        </div>

        <!-- Estrutura de Arquivos -->
        <div class="card">
            <h2>üìÅ Estrutura de Arquivos Criados</h2>
            <div class="file-tree">
<span class="folder">app/</span>
‚îú‚îÄ‚îÄ <span class="folder">Livewire/Public/</span>
‚îÇ   ‚îú‚îÄ‚îÄ <span class="file">SearchTickets.php</span> ................... Homepage com busca
‚îÇ   ‚îú‚îÄ‚îÄ <span class="file">AvailableTrips.php</span> ................. Lista de viagens dispon√≠veis
‚îÇ   ‚îî‚îÄ‚îÄ <span class="file">SeatSelection.php</span> .................. Sele√ß√£o de assentos
‚îú‚îÄ‚îÄ <span class="folder">Models/</span>
‚îÇ   ‚îî‚îÄ‚îÄ <span class="file">TemporaryReservation.php</span> ........... Reservas tempor√°rias

<span class="folder">resources/views/</span>
‚îú‚îÄ‚îÄ <span class="folder">components/layouts/</span>
‚îÇ   ‚îî‚îÄ‚îÄ <span class="file">public.blade.php</span> ................... Layout p√∫blico
‚îî‚îÄ‚îÄ <span class="folder">livewire/public/</span>
    ‚îú‚îÄ‚îÄ <span class="file">search-tickets.blade.php</span> ........... View da homepage
    ‚îú‚îÄ‚îÄ <span class="file">available-trips.blade.php</span> .......... View de resultados
    ‚îî‚îÄ‚îÄ <span class="file">seat-selection.blade.php</span> ........... View de assentos

<span class="folder">routes/</span>
‚îî‚îÄ‚îÄ <span class="file">public.php</span> ............................ Rotas p√∫blicas

<span class="folder">database/migrations/</span>
‚îî‚îÄ‚îÄ <span class="file">2025_01_14_000000_create_temporary_reservations_table.php</span>
            </div>
        </div>

        <!-- Passo 1: Copiar Arquivos -->
        <div class="card">
            <h2>1Ô∏è‚É£ Copiar Arquivos para o Projeto</h2>
            
            <div class="step">
                <span class="step-number">1</span>
                <strong>Copie os componentes Livewire:</strong>
            </div>
            <pre><code>app/Livewire/Public/SearchTickets.php
app/Livewire/Public/AvailableTrips.php
app/Livewire/Public/SeatSelection.php</code></pre>

            <div class="step">
                <span class="step-number">2</span>
                <strong>Copie as views Blade:</strong>
            </div>
            <pre><code>resources/views/components/layouts/public.blade.php
resources/views/livewire/public/search-tickets.blade.php
resources/views/livewire/public/available-trips.blade.php
resources/views/livewire/public/seat-selection.blade.php</code></pre>

            <div class="step">
                <span class="step-number">3</span>
                <strong>Copie o Model e Migration:</strong>
            </div>
            <pre><code>app/Models/TemporaryReservation.php
database/migrations/2025_01_14_000000_create_temporary_reservations_table.php</code></pre>

            <div class="step">
                <span class="step-number">4</span>
                <strong>Copie as rotas:</strong>
            </div>
            <pre><code>routes/public.php</code></pre>
        </div>

        <!-- Passo 2: Configurar Rotas -->
        <div class="card">
            <h2>2Ô∏è‚É£ Configurar Rotas</h2>
            
            <p>Edite o arquivo <code>routes/web.php</code> e adicione no <strong>IN√çCIO</strong> do arquivo:</p>
            
            <pre><code>// Incluir rotas p√∫blicas
require __DIR__.'/public.php';</code></pre>

            <div class="warning">
                <strong>‚ö†Ô∏è IMPORTANTE:</strong> Coloque esta linha ANTES das outras rotas para que a rota <code>/</code> (homepage) funcione corretamente.
            </div>

            <p>Se voc√™ j√° tem uma rota <code>/</code> no web.php, comente ou remova ela:</p>
            <pre><code>// Route::get('/', function () {
//     return view('welcome');
// })->name('home');</code></pre>
        </div>

        <!-- Passo 3: Executar Migration -->
        <div class="card">
            <h2>3Ô∏è‚É£ Executar Migration</h2>
            
            <p>Execute o comando para criar a tabela de reservas tempor√°rias:</p>
            <pre><code>php artisan migrate</code></pre>

            <div class="success">
                ‚úÖ Isso criar√° a tabela <code>temporary_reservations</code> no banco de dados.
            </div>
        </div>

        <!-- Passo 4: Atualizar Models Existentes -->
        <div class="card">
            <h2>4Ô∏è‚É£ Atualizar Models Existentes</h2>
            
            <h3>Schedule.php</h3>
            <p>Adicione o relacionamento com reservas tempor√°rias:</p>
            <pre><code>/**
 * Get temporary reservations for this schedule.
 */
public function temporaryReservations(): HasMany
{
    return $this->hasMany(TemporaryReservation::class);
}

/**
 * Get available seats count.
 */
public function availableSeats(): int
{
    $bookedSeats = $this->tickets()
        ->whereIn('status', ['reserved', 'paid', 'validated'])
        ->count();

    $temporaryReservations = $this->temporaryReservations()
        ->where('expires_at', '>', now())
        ->count();

    return $this->bus->total_seats - ($bookedSeats + $temporaryReservations);
}</code></pre>
        </div>

        <!-- Passo 5: Instalar Alpine.js -->
        <div class="card">
            <h2>5Ô∏è‚É£ Instalar Alpine.js (Opcional)</h2>
            
            <p>O componente de sele√ß√£o de assentos usa Alpine.js para o timer. Se ainda n√£o tiver instalado, adicione ao layout:</p>
            
            <div class="info">
                <strong>üìù NOTA:</strong> O Alpine.js j√° est√° inclu√≠do no push de scripts da view de sele√ß√£o de assentos.
            </div>
        </div>

        <!-- Passo 6: Limpar Cache -->
        <div class="card">
            <h2>6Ô∏è‚É£ Limpar Cache do Laravel</h2>
            
            <p>Execute os comandos para limpar o cache:</p>
            <pre><code>php artisan route:clear
php artisan view:clear
php artisan config:clear
php artisan cache:clear</code></pre>
        </div>

        <!-- Fluxo Completo -->
        <div class="card">
            <h2>üîÑ Fluxo Completo do Sistema</h2>
            
            <table>
                <thead>
                    <tr>
                        <th>Passo</th>
                        <th>Componente</th>
                        <th>Rota</th>
                        <th>Descri√ß√£o</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><span class="badge badge-success">1</span></td>
                        <td>SearchTickets</td>
                        <td><code>/</code></td>
                        <td>Homepage com formul√°rio de busca</td>
                    </tr>
                    <tr>
                        <td><span class="badge badge-success">2</span></td>
                        <td>AvailableTrips</td>
                        <td><code>/viagens</code></td>
                        <td>Lista de hor√°rios dispon√≠veis</td>
                    </tr>
                    <tr>
                        <td><span class="badge badge-success">3</span></td>
                        <td>SeatSelection</td>
                        <td><code>/assentos/{schedule}</code></td>
                        <td>Mapa visual de assentos</td>
                    </tr>
                    <tr>
                        <td><span class="badge badge-warning">4</span></td>
                        <td>PassengerInfo</td>
                        <td><code>/checkout/{schedule}/{seats}</code></td>
                        <td>üöß A CRIAR - Dados e pagamento</td>
                    </tr>
                    <tr>
                        <td><span class="badge badge-warning">5</span></td>
                        <td>TicketConfirmation</td>
                        <td><code>/bilhete/{ticket}</code></td>
                        <td>üöß A CRIAR - Confirma√ß√£o</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Funcionalidades Implementadas -->
        <div class="card">
            <h2>‚úÖ Funcionalidades Implementadas</h2>
            
            <h3>1. Homepage (SearchTickets)</h3>
            <ul>
                <li>Formul√°rio de busca com origem, destino, data e passageiros</li>
                <li>Bot√£o para trocar origem/destino</li>
                <li>Valida√ß√£o em tempo real</li>
                <li>Exibi√ß√£o de rotas populares</li>
                <li>Se√ß√£o "Como Funciona"</li>
                <li>Design responsivo e moderno</li>
            </ul>

            <h3>2. Resultados (AvailableTrips)</h3>
            <ul>
                <li>Lista de hor√°rios dispon√≠veis</li>
                <li>Filtros por per√≠odo do dia (manh√£, tarde, noite)</li>
                <li>Ordena√ß√£o por pre√ßo ou hor√°rio</li>
                <li>Informa√ß√µes de disponibilidade em tempo real</li>
                <li>Alertas para √∫ltimos lugares</li>
                <li>Indica√ß√£o de hor√°rios esgotados</li>
            </ul>

            <h3>3. Sele√ß√£o de Assentos (SeatSelection)</h3>
            <ul>
                <li>Mapa visual interativo do autocarro</li>
                <li>Estados dos assentos: dispon√≠vel, ocupado, selecionado</li>
                <li>Reserva tempor√°ria de 15 minutos com timer</li>
                <li>Valida√ß√£o de disponibilidade em tempo real</li>
                <li>Resumo da compra</li>
                <li>C√°lculo autom√°tico do total</li>
                <li>Anima√ß√µes e feedback visual</li>
            </ul>
        </div>

        <!-- Pr√≥ximos Passos -->
        <div class="card">
            <h2>üöÄ Pr√≥ximos Passos</h2>
            
            <div class="info">
                <strong>Componentes a desenvolver:</strong>
            </div>
            
            <ol>
                <li><strong>PassengerInfo:</strong> Formul√°rio com dados do passageiro</li>
                <li><strong>PaymentProcess:</strong> Integra√ß√£o M-Pesa/e-Mola</li>
                <li><strong>TicketConfirmation:</strong> Gera√ß√£o de QR Code e envio</li>
                <li><strong>MyTickets:</strong> Consulta de bilhetes por n√∫mero/email</li>
                <li><strong>TicketValidation:</strong> Valida√ß√£o de QR Code</li>
            </ol>
        </div>

        <!-- Dicas -->
        <div class="card">
            <h2>üí° Dicas e Observa√ß√µes</h2>
            
            <div class="warning">
                <strong>‚ö†Ô∏è Sess√µes:</strong> O sistema usa <code>session()->getId()</code> para identificar reservas tempor√°rias. Certifique-se de que as sess√µes est√£o configuradas corretamente.
            </div>

            <div class="info">
                <strong>üîÑ Limpeza Autom√°tica:</strong> As reservas tempor√°rias expiradas s√£o limpas automaticamente ao criar novas reservas.
            </div>

            <div class="success">
                <strong>‚úÖ Performance:</strong> Use √≠ndices no banco de dados e considere cache para rotas populares.
            </div>
        </div>

        <!-- Testes -->
        <div class="card">
            <h2>üß™ Como Testar</h2>
            
            <ol>
                <li>Acesse <code>http://seu-dominio.test/</code></li>
                <li>Preencha o formul√°rio de busca</li>
                <li>Selecione uma viagem dispon√≠vel</li>
                <li>Escolha os assentos no mapa visual</li>
                <li>Observe o timer de 15 minutos</li>
                <li>Clique em "Continuar para Pagamento"</li>
            </ol>

            <div class="warning">
                <strong>‚ö†Ô∏è IMPORTANTE:</strong> Voc√™ precisa ter dados no banco (cidades, rotas, autocarros, hor√°rios) para testar o sistema.
            </div>
        </div>

        <!-- Footer -->
        <div class="card" style="text-align: center; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
            <h2 style="color: white; border: none;">üéâ Sistema Pronto para Testar!</h2>
            <p>Qualquer d√∫vida, estou aqui para ajudar! üöÄ</p>
        </div>
    </div>
</body>
</html>